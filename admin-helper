#!/bin/bash

set -e -u
username=$SUDO_USER
delay=$((60*1)) #20 minutes
uGuid=$(dscl . -read /Users/$username/ GeneratedUID | sed -nE 's/GeneratedUID: (.*$)/\1/p')

if groups $username | grep -q -w admin;
    then
        dscl . -delete /Groups/admin GroupMembers "$uGuid"
        echo "Removed '$username' from admin"
    else
        echo "'$username' is not an admin"
        echo "Sleeping for $delay seconds staring from $(date '+%D %T')" 
        sleep "$delay"
        dscl . -append /Groups/admin GroupMembers "$uGuid"
fi
